#!/usr/bin/env nix-shell
#! nix-shell -i bash -p xcape

# Customize the (German) keyboard with xmodmap and xcape

# Reset
killall --signal SIGKILL xcape
setxkbmap de

# Use the CapsLock key as escape when pressed alone and ctrl when pressed with some other key
xmodmap -e 'remove Lock = Caps_Lock'
xmodmap -e 'remove Control = Control_L'
xmodmap -e 'keysym Control_L = 0'
xmodmap -e 'keysym Caps_Lock = Control_L'
xmodmap -e 'add Control = Control_L'
xcape -e 'Control_L=Escape'

# Use tab as alt-gr
key="ISO_Level3_Shift"
xmodmap -e "keysym Tab = $key"
xmodmap -e "remove mod4 = $key"
xmodmap -e 'keycode any = Tab'
xcape -e "$key=Tab"

# I prefer my keys alive
xmodmap -e 'keysym dead_circumflex = asciicircum'
xmodmap -e 'keysym dead_acute = acute grave'

# Make \ reachable (I never needed ยง anyway)
xmodmap -e 'keysym 3 = 3 backslash'

# Use rctrl as a play/pause media key (for usage when my handy aren't on the homerow)
# since it is nearly unreachable when my hands are on the homerow anyway
xmodmap -e 'remove Control = Control_R'
xmodmap -e 'keysym Control_R = XF86AudioPlay'

# Use the 'รถ' key (right of l on the German keyboard) as an extra modifier when pressed with some
# other key
to_remap='odiaeresis'
target_modifier='Hyper_L'
xmodmap -e "keysym $to_remap = $target_modifier"
xmodmap -e "keycode 255 = $to_remap"
xcape -e "Hyper_L=$to_remap"

wait
