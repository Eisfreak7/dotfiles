#!/bin/bash
if [[ $1 == 'copy' ]]; then copy=true; else copy=false; fi

target=$(find ~/.password-store/ -iname '*.gpg' -type f | sed -nre 's/^.*\/.password-store\/(.+).gpg/\1/p' | dmenu -l 5 )
if [[ -n "$target" ]] ; then
	if $copy; then
		pass -c "$target"
		if [[ $? -eq 0 ]] ; then
			notify-send --urgency=low "Copied $target to clipboard. Will clear in 45 seconds"
		else
			notify-send --urgency=low "Failed. Possibly the password was wrong?"
		fi
	else
		xdotool type "$(pass show "$target")"
	fi
fi
